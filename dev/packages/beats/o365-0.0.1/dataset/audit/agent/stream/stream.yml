{{#if input == o365audit}}
input: o365audit
{{#if application_id}}application_id: {{ .application_id}}{{ end}}
tenant_id:
{{#each tenants}}
  - {{this}}
{{/each}}
{{#if certificate}}certificate: {{ .certificate}}{{ end}}
{{#if key}}key: {{ .key}}{{ end}}
{{#if key_passphrase}}key_passphrase: {{ .key_passphrase}}{{ end}}
{{#if client_secret}}client_secret: {{ .client_secret}}{{ end}}
{{ if eq "string" (printf "%T" .content_type) }}
content_type: {{content_type}}
{{else}}
content_type:
{{#each content_type}}
  - {{this}}
{{/each}}
{{/if}}
{{#if api}}
api:
{{#each api}}
  - {{this}}
{{/each}}
{{/if}}
{{else if input == file}}
input: log
paths:
{{#each paths}}
  - {{this}}
{{/each}}
exclude_files: [".gz$"]
json.add_error_key: true
{{/if}}
processors:
{{#if input == file}}
  - rename:
     fields:
      - from: json
        to: o365audit
  - timestamp:
      field: o365audit.CreationTime
      layouts:
        - 2006-01-02T15:04:05
{{/if}}
  - script:
      lang: javascript
      id: o365audit_script
      file: ${path.home}/module/o365/audit/config/pipeline.js
      params:
        debug: false
        tenants:
{{#each tenants}}
  - {{this}}
{{/each}}
